import{_ as J,c as K,g as Q,r,a as W,b as X,o as Y,d as w,u as s,e as Z,f as ee,h as oe,q as ae,i as se,w as le,j as te,k as ne,l as re,m as ie,n as m,p as t,s as l,I as ce,t as ue,v as de,x as z,y as ge,z as f,A as b,B as P,C as S,D as V,E as x,F as B,G as ve,H as R,J as F,K as pe,L as me,M as fe,N as Ie,O as ze,P as y,Q as Ce,R as he}from"./index-DQon6D7l.js";const we={class:"scritta-nessuno"},be={class:"shop-cards"},ye=["src"],_e={__name:"HomeCliente",setup(ke){const C=K.map(a=>a.nome),H=Q();r(null);const n=r([]),M=Z(),_=ee(),k=W(),E=X(),I=r(!1);let i=r([]);const c=r(""),D=r(""),u=r(!0),d=r(0),g=r([]),h=r(!1),T=()=>{h.value=!0,console.log("click")},N=()=>{h.value=!1};function q(a){const e=a.target.value.toLowerCase();console.log("cercaper citta"),e===""?g.value=C:(console.log(C),g.value=C.filter(o=>o.toLowerCase().includes(e)),console.log("suggestion",g.value))}async function O(a){c.value=a,g.value=[],N(),await L(a),i.value=n.value,await U(),i.value=n.value}function j(a){console.log("Input Value:",a.target.value);const e=a.target.value.toLowerCase();e===""?i.value=[...n.value]:(console.log("Filtering items based on search value:",e),i.value=n.value.filter(o=>o.nomeNegozio.toLowerCase().includes(e))),console.log("Updated itemsCopy size:",i.value.length)}const L=async a=>{try{console.log("Inizio caricamento negozi..."),I.value=!0;const e=await oe(ae(se(k,"Negozi"),le("cittaNegozio","==",a)));console.log("Documenti negozi recuperati:",e.size),n.value=e.docs.map(o=>({id:o.id,...o.data()})),I.value=!1}catch(e){I.value=!1,console.error("Errore durante il recupero dei negozi:",e.message)}},U=async()=>{u.value=!0,d.value=0;const a=n.value.length;n.value=await Promise.all(n.value.map(async(e,o)=>{const v=te(H,"images/".concat(e.id));let p="";try{p=await ne(v),console.log("URL immagine per il negozio con ID ".concat(e.id,":"),p),d.value=(o+1)/a*100,console.log("Progresso: ".concat(d.value,"%"))}catch($){switch($.code){case"storage/object-not-found":console.error("File non trovato per il negozio con ID ".concat(e.id));break;case"storage/unauthorized":console.error("Utente non autorizzato per il negozio con ID ".concat(e.id));break;default:console.error("Errore sconosciuto durante il recupero dell'URL di download per il negozio con ID ".concat(e.id,":"),$);break}}return{id:e.id,...e,imageUrl:p}})),d.value=100,console.log("Caricamento delle immagini completato."),u.value=!1},A=async()=>{try{const a=re(k,"Cliente",D.value),e=await ie(a);e.exists()?(c.value=e.data().citta,console.log("citta cliente="+c.value)):console.log("Il documento non esiste.")}catch(a){console.error("Errore durante il recupero del documento:",a.message)}},G=a=>{try{console.log("id document on click "+a.id),_.dispatch("setIdDocumentNegozioSelezionato",a.id),_.dispatch("setUrlNegozioSelezionato",a.imageUrl)}catch(e){console.error(e.message)}M.push("/cliente/tabs/tab1/informazioniNegozio")};return Y(async()=>{u.value=!0,D.value=E.currentUser.uid,await A(),await L(c.value),i.value=n.value,await U(),i.value=n.value,u.value=!1}),(a,e)=>(m(),w(s(pe),null,{default:t(()=>[l(s(ge),null,{default:t(()=>[l(s(ce),{color:"primary"},{default:t(()=>[l(s(ue),{"is-open":I.value,message:"Please wait..."},null,8,["is-open"]),l(s(de),null,{default:t(()=>e[4]||(e[4]=[z("Home")])),_:1})]),_:1})]),_:1}),l(s(R),{class:"ion-padding"},{default:t(()=>[e[6]||(e[6]=f("div",{class:"category-buttons"},null,-1)),l(s(b),{class:"ion-searchbar",animated:"true","show-clear-button":"focus",placeholder:"Cerca per nome",debounce:500,onIonInput:e[0]||(e[0]=o=>j(o))}),l(s(b),{class:"ion-searchbar",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),animated:"true","show-clear-button":"focus",placeholder:"Cerca per città",debounce:500,onClick:e[2]||(e[2]=o=>T())},null,8,["modelValue"]),P(f("p",we,"nessun negozio trovato in base alla città o al nome",512),[[S,s(i).size===0]]),f("div",be,[(m(!0),V(B,null,x(s(i),(o,v)=>(m(),w(s(me),{class:"shop-card",key:v,onClick:p=>G(o)},{default:t(()=>[f("img",{class:"card-image",alt:"Image of shop",src:o.imageUrl},null,8,ye),P(l(s(fe),{value:d.value/100,color:"primary"},null,8,["value"]),[[S,u.value]]),l(s(Ie),{class:"card-header"},{default:t(()=>[l(s(ze),null,{default:t(()=>[z(y(o.nomeNegozio),1)]),_:2},1024)]),_:2},1024),e[5]||(e[5]=f("div",{class:"line"},null,-1)),l(s(Ce),{class:"card-content"},{default:t(()=>[z(y(o.indirizzoNegozio+","+o.cittaNegozio),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),l(s(ve),{"is-open":h.value,onDidDismiss:N,"initial-breakpoint":.75,breakpoints:[0,.25,.5,.75]},{default:t(()=>[l(s(R),{class:"ion-padding"},{default:t(()=>[l(s(b),{class:"ion-searchbar",animated:"true","show-clear-button":"focus",placeholder:"Inserisci la citta che vuoi cercare",debounce:500,onIonInput:e[3]||(e[3]=o=>q(o))}),l(s(F),null,{default:t(()=>[l(s(F),{class:"suggestions-list"},{default:t(()=>[(m(!0),V(B,null,x(g.value,(o,v)=>(m(),w(s(he),{key:v,onClick:p=>O(o),lines:"full",detail:""},{default:t(()=>[z(y(o),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}},Ne=J(_e,[["__scopeId","data-v-12701ec6"]]);export{Ne as default};

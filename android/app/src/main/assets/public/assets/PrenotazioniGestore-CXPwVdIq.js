import{_ as pe,a as me,r as y,o as Te,af as Fe,ag as Le,n as v,d as Z,p as n,s as a,u as o,y as ge,I as ve,v as ze,x as c,a7 as Be,a2 as U,H as Ie,D,z as g,L as ae,N as ie,O as le,Q as re,J as se,R as w,a8 as C,ah as _,P as d,ai as O,t as Se,G as qe,l as H,m as ce,a1 as ue,a6 as He,b as Ue,aj as G,U as Re,f as Ve,e as je,q as h,i as j,w as q,h as Q,ak as de,E as Y,F as K,al as We,am as Je,K as he,an as fe,ao as Qe,a0 as Ye,ap as Ke}from"./index-DQon6D7l.js";const Ze={key:0},Xe={class:"prenotazione-section"},eo={key:0,class:"cliente-section"},oo={class:"actions-section"},to={class:"actions-section"},no={__name:"AlertInformazioniPrenotazione",props:["isOpen","prenotazioneSelected"],emits:["close-modal","ricarica-orari"],setup(X,{emit:W}){const m=X,R=W,I=me(),u=y(null),z=y(!1);Te(()=>{console.log("Modal montato")}),Fe(()=>{console.log("Modal smontato")});const $=()=>console.log("Modal sta per essere presentato"),k=()=>console.log("Modal è stato presentato"),A=()=>{console.log("Modal sta per essere chiuso"),S()},N=()=>console.log("Modal è stato chiuso");Le(()=>{m.prenotazioneSelected&&E()});const E=async()=>{try{z.value=!0;const p=H(I,"Cliente",m.prenotazioneSelected.idDocumentCliente),l=await ce(p);l.exists()?(u.value=l.data(),console.log(u.value)):console.log("Errore nel recupero delle informazioni cliente")}catch(p){console.error("Errore nel recupero delle informazioni del cliente:",p),u.value=null}finally{z.value=!1}},x=async()=>{try{z.value=!0;const p=H(I,"Prenotazioni",m.prenotazioneSelected.id);await ue(p),console.log("Prenotazione eliminata con successo"),S(),R("ricarica-orari")}catch(p){console.error("Errore durante l'eliminazione della prenotazione:",p)}finally{z.value=!1}},S=()=>R("close-modal"),b=()=>{window.confirm("Attenzione! Bloccare questo cliente impedirà a questa email di fare prenotazioni in futuro. Sei sicuro di voler procedere?")&&T()},T=async()=>{try{z.value=!0;const p=H(I,"Cliente",m.prenotazioneSelected.idDocumentCliente),l=await ce(p);if(l.exists()){const M=l.data();M.bloccato=!0;const F=H(I,"ClientiBloccati",p.id);await He(F,M),await ue(p),console.log("Cliente spostato con successo nella collezione ClientiBloccati"),alert("Cliente bloccato con successo. Non potrà più effettuare prenotazioni.")}else console.log("Cliente non trovato nella collezione Cliente.")}catch(p){console.error("Errore nel bloccare il cliente:",p)}finally{z.value=!1}};return(p,l)=>(v(),Z(o(qe),{"is-open":m.isOpen,onClose:l[2]||(l[2]=M=>S()),"backdrop-dismiss":"true",onIonModalWillPresent:$,onIonModalDidPresent:k,onIonModalWillDismiss:A,onIonModalDidDismiss:N},{default:n(()=>[a(o(ge),null,{default:n(()=>[a(o(ve),{color:"primary"},{default:n(()=>[a(o(ze),null,{default:n(()=>l[3]||(l[3]=[c("Dettagli")])),_:1}),a(o(Be),{slot:"end"},{default:n(()=>[a(o(U),{onClick:l[0]||(l[0]=M=>S())},{default:n(()=>l[4]||(l[4]=[c("Chiudi")])),_:1})]),_:1})]),_:1})]),_:1}),a(o(Ie),{class:"ion-padding"},{default:n(()=>[m.prenotazioneSelected||u.value?(v(),D("div",Ze,[g("section",Xe,[a(o(ae),null,{default:n(()=>[a(o(ie),null,{default:n(()=>[a(o(le),{class:"ion-text-center"},{default:n(()=>l[5]||(l[5]=[c("Prenotazione")])),_:1})]),_:1}),a(o(re),null,{default:n(()=>[a(o(se),null,{default:n(()=>[a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[6]||(l[6]=[c("Servizio:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(m.prenotazioneSelected.servizioSelezionato),1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[7]||(l[7]=[c("Durata:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(m.prenotazioneSelected.durataServizioSelezionato)+" minuti",1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[8]||(l[8]=[c("Ora Inizio:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(m.prenotazioneSelected.oraInizio),1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[9]||(l[9]=[c("Ora Fine:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(m.prenotazioneSelected.oraFine),1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[10]||(l[10]=[c("Commento:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(m.prenotazioneSelected.commento),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),u.value?(v(),D("section",eo,[a(o(ae),null,{default:n(()=>[a(o(ie),null,{default:n(()=>[a(o(le),{class:"ion-text-center"},{default:n(()=>l[11]||(l[11]=[c("Cliente")])),_:1})]),_:1}),a(o(re),null,{default:n(()=>[a(o(se),null,{default:n(()=>[a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[12]||(l[12]=[c("Nome:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(u.value.nome)+" "+d(u.value.cognome),1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[13]||(l[13]=[c("Cellulare:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(u.value.cellulare),1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[14]||(l[14]=[c("Email:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(u.value.email),1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[15]||(l[15]=[c("Città:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(u.value.citta),1)]),_:1})]),_:1}),a(o(w),null,{default:n(()=>[a(o(C),{class:"ion-text-bold"},{default:n(()=>l[16]||(l[16]=[c("Indirizzo:")])),_:1}),a(o(_),null,{default:n(()=>[c(d(u.value.via)+" "+d(u.value.numeroCivico),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):O("",!0),g("section",oo,[a(o(U),{color:"danger",onClick:b},{default:n(()=>l[17]||(l[17]=[c("Blocca Cliente")])),_:1})]),g("section",to,[a(o(U),{color:"danger",expand:"block",onClick:l[1]||(l[1]=M=>x())},{default:n(()=>l[18]||(l[18]=[c("Elimina Prenotazione")])),_:1})])])):O("",!0),a(o(Se),{"is-open":z.value,message:"Attendere..."},null,8,["is-open"])]),_:1})]),_:1},8,["is-open"]))}},ao=pe(no,[["__scopeId","data-v-385d70b4"]]),io={class:"div-navigazione-mese"},lo={class:"mese-titolo"},ro=["onClick"],so={key:0},co=["onClick"],uo={class:"div-informazioni-prenotazione"},fo={key:0},po={key:1,style:{"font-size":"small"}},mo={class:"popover-content"},go={class:"prenotazione-details"},vo={__name:"PrenotazioniGestore",setup(X){const W=Ve(),m=me();je();const R=Ue(),I=y(!1);let u=G(new Date),z=G([]),$=G(new Map),k=G(new Set),A=G(new Set),N=y(!1);const E=y(null);let x=y("");const S=G(new Set);var b=y(!1);const T=W.getters.getIdDocumentNegozioGestore,p=y("");var l=y([]),M=y(0);const{isModalOpen:F,openModal:ye,closeModal:De}={isModalOpen:y(!1),openModal:()=>F.value=!0,closeModal:()=>F.value=!1};function we(){b.value=!0}async function Ce(){await L()}const _e=async(i,t,e)=>{if(t){p.value=e;const r=H(m,"Prenotazioni",e.id);await Qe(r,{new:!1}),console.log("Prenotazione aggiornata, campo 'nuovo' impostato a false."),ye(),console.log("prenotato aperto modal")}else{const r=[{text:"Annulla",cssClass:"alert-button-cancel"},{text:"Conferma",cssClass:"alert-button-confirm",handler:async P=>{const B=P[0],Ee=P[1];await Ne(B,Ee,i)}}],s=[{type:"textarea",placeholder:"Inserisci il nome del cliente"},{type:"textarea",placeholder:"Inserisci eventuale descrizione"}];await(await Ye.create({header:"Inserisci manualmente la prenotazione",buttons:r,inputs:s})).present()}};function J(i){const t=i.getMonth(),e=i.getFullYear(),r=new Date(e,t,1),s=new Date(e,t+1,0),f=[];for(;r<=s;){const P=new Intl.DateTimeFormat("it-IT",{weekday:"long"}).format(r),B={nomeGiornoSettimana:P.charAt(0).toUpperCase()+P.slice(1),numeroGiorno:r.getDate()};f.push(B),r.setDate(r.getDate()+1)}return f}async function V(){try{I.value=!0;const i=R.currentUser.uid,t=h(j(m,"Negozi"),q("proprietarioUid","==",i)),e=await Q(t);if(e.empty)console.error("Nessun documento trovato con uiduser");else{const s=e.docs[0].data().orariLavorativi;$=new Map(Object.entries(s)),console.log("orariMap",$),$.forEach((f,P)=>{$.set(P,f.sort(Me))}),Pe($e(u))}I.value=!1}catch(i){I.value=!1,console.error("Errore durante il recupero degli orari:",i)}}function Me(i,t){const[e,r]=i.split(":").map(Number),[s,f]=t.split(":").map(Number);return e!==s?e-s:r-f}function Pe(i){console.log("Funzione prendiOrariPergiorno chiamata con il giorno:",i),k.clear(),console.log("orariPerGiorno è stato svuotato.");const t=i.nomeGiornoSettimana;console.log("Nome del giorno della settimana:",t),$.forEach((e,r)=>{r==t&&(console.log("Trovato ".concat(r," nella mappa degli orari con valori:"),e),e.forEach(s=>{console.log("Aggiungendo ora ".concat(s," per il giorno ").concat(t)),k.add(s)}))}),console.log("Orari per il giorno ".concat(t,":"),Array.from(k))}function $e(i){const t=new Intl.DateTimeFormat("it-IT",{weekday:"long"}).format(i),e={nomeGiornoSettimana:t.charAt(0).toUpperCase()+t.slice(1),numeroGiorno:i.getDate()};return console.log(e),e}async function L(){try{I.value=!0,A.clear(),l.value=[],console.log("Prenotazioni precedenti cancellate.");const i=h(j(m,"Prenotazioni"),q("idDocumentNegozio","==",T),q("dataPrenotazione",">=",u),q("dataPrenotazione","<",new Date(u.getTime()+24*60*60*1e3))),t=h(j(m,"Prenotazioni"),q("idDocumentNegozio","==",T));console.log("Esecuzione della query per recuperare tutte le prenotazioni.");const e=await Q(t);console.log("Trovate ".concat(e.size," prenotazioni totali.")),e.forEach(async s=>{const f=s.data();f.id=s.id,f.new===!0&&(l.value.push(f),console.log("Aggiunta nuova prenotazione: ".concat(JSON.stringify(f))))}),M.value=l.value.length,console.log("Numero di nuove prenotazioni: ".concat(M.value));const r=await Q(i);console.log("Query prenotazioni:",r),r.forEach(async s=>{const f=s.data();f.id=s.id,A.add(f),console.log("Aggiunta prenotazione al set: ".concat(JSON.stringify(f)))}),be(A,k),console.log("Set delle prenotazioni creato."),N.value=!0,I.value=!1,console.log("Operazione completata con successo.")}catch(i){I.value=!1,console.error("Errore durante il recupero delle prenotazioni:",i)}}function be(i,t){console.log("Inizio creazione set oggetti orario."),S.clear();for(const e of t){console.log("Verifica orario: ".concat(e));const r=Array.from(i).find(s=>s.oraInizio==e);if(r)console.log("Trovata prenotazione per orario ".concat(e,":"),r),ke(r);else{console.log("Nessuna prenotazione trovata per orario ".concat(e,". Creazione nuovo oggetto orario."));const s={prenotato:!1,oraInizio:e,sceltaUtente:"",nomeCliente:"",prenotazione:""};ee(s.oraInizio)?console.log("Orario ".concat(e," già presente in setOggettiOrario.")):(S.add(s),console.log("Orario ".concat(e," aggiunto a setOggettiOrario.")))}}console.log("Set oggetti orario creato:",Array.from(S))}function ke(i){const t=i.durataServizioSelezionato;console.log("durata",t);const e=t/15;for(let r=0;r<e;r++){const f={prenotato:!0,oraInizio:Oe(i.oraInizio,r*15),sceltaUtente:i.servizioSelezionato,nomeCliente:i.nomeCliente,prenotazione:i,new:i.new};ee(f.oraInizio)||S.add(f)}console.log("Prenotazione orari consecutivi:",Array.from(S))}function ee(i){return Array.from(S).some(t=>t.oraInizio===i)}async function Ne(i,t,e){try{const r={dataPrenotazione:u,idDocumentNegozio:T,oraInizio:e,nomeCliente:i,servizioSelezionato:t,durataServizioSelezionato:15};await Ke(j(m,"Prenotazioni"),r),console.log("Prenotazione inserita:",r),await V(),await L()}catch(r){console.error("Errore durante l'inserimento della prenotazione:",r)}}const oe=i=>i<10?"0".concat(i):i.toString(),xe=(i,t)=>{const[e,r]=i.split(":").map(Number),s=new Date;return s.setHours(e),s.setMinutes(r+t),"".concat(oe(s.getHours()),":").concat(oe(s.getMinutes()))};async function te(i){N.value=!1;const t=new Date(u);t.setMonth(t.getMonth()+i),u=t,x=new Intl.DateTimeFormat("it-IT",{month:"long"}).format(u),z=J(u),await V(),await L(),N.value=!0,ne(u.getDate()),console.log("Mese spostato a ".concat(x,", giorni del mese:"),z)}Re(async()=>{u.setHours(0,0,0,0),x=new Intl.DateTimeFormat("it-IT",{month:"long"}).format(u),z=J(u),await V(),await L(),ne(u.getDate()),console.log("IonViewDidEnter eseguito con successo.")});function ne(i){if(E.value){const t=E.value,e=t.children[i];if(e){const r=e.offsetLeft-t.offsetLeft-300;t.scrollLeft=r,console.log("Scroll effettuato a ".concat(i," giorno del mese."))}}}async function Ge(i){u.setDate(i.numeroGiorno),z=J(u),await V(),await L(),console.log("Giorno ".concat(u.toLocaleDateString()," cliccato."))}function Oe(i,t){const[e,r]=i.split(":").map(Number),s=new Date;return s.setHours(e),s.setMinutes(r+t),"".concat(String(s.getHours()).padStart(2,"0"),":").concat(String(s.getMinutes()).padStart(2,"0"))}function Ae(i){if(!i||typeof i!="object")return"Data non valida";const t=i.seconds*1e3+Math.floor(i.nanoseconds/1e6),e=new Date(t),r=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),f=e.getFullYear(),P=String(e.getHours()).padStart(2,"0"),B=String(e.getMinutes()).padStart(2,"0");return"".concat(r,"/").concat(s,"/").concat(f," ore ").concat(P,":").concat(B)}return(i,t)=>(v(),Z(o(he),null,{default:n(()=>[a(o(ge),null,{default:n(()=>[a(o(ve),{color:"primary"},{default:n(()=>[a(o(ze),null,{default:n(()=>t[4]||(t[4]=[c("Prenotazioni")])),_:1}),a(o(Se),{"is-open":I.value,message:"Please wait..."},null,8,["is-open"])]),_:1})]),_:1}),a(o(Ie),{class:"ion-padding"},{default:n(()=>[g("div",io,[a(o(U),{onClick:t[0]||(t[0]=e=>te(-1)),class:"button-avanti-indietro"},{default:n(()=>t[5]||(t[5]=[c("Indietro")])),_:1}),g("p",lo,d(o(x)),1),a(o(U),{onClick:t[1]||(t[1]=e=>te(1)),class:"button-avanti-indietro"},{default:n(()=>t[6]||(t[6]=[c("Avanti")])),_:1}),a(o(de),{color:"warning",onClick:t[2]||(t[2]=e=>we())},{default:n(()=>[c(" Hai "+d(o(M))+" nuove prenotazioni ",1)]),_:1})]),g("div",{class:"div-contenitore-giorni",ref_key:"contenitoreGiorni",ref:E},[(v(!0),D(K,null,Y(o(z),(e,r)=>(v(),D("div",{class:fe(["div-giorno",{"giorno-selezionato":o(u).getDate()===e.numeroGiorno}]),key:r,onClick:s=>Ge(e)},d(e.nomeGiornoSettimana)+" "+d(e.numeroGiorno),11,ro))),128))],512),o(N)?(v(),D("div",so,[(v(!0),D(K,null,Y(S,(e,r)=>(v(),D("div",{key:r,class:"div-contenitore-orario",onClick:s=>_e(e.oraInizio,e.prenotato,e.prenotazione)},[g("div",{class:fe({"div-orario":e.prenotato==!1,"div-orario-prenotato":e.prenotato==!0})},d(e.oraInizio)+" / "+d(xe(e.oraInizio,15)),3),g("div",uo,[e.prenotato?(v(),D("div",fo,d(e.nomeCliente),1)):O("",!0),e.prenotato?(v(),D("div",po,d(e.sceltaUtente),1)):O("",!0)]),e.new?(v(),Z(o(de),{key:0,color:"warning"},{default:n(()=>t[7]||(t[7]=[c("New")])),_:1})):O("",!0)],8,co))),128))])):O("",!0)]),_:1}),a(o(Je),{"is-open":o(b),onIonPopoverDidDismiss:t[3]||(t[3]=e=>We(b)?b.value=!1:b=!1)},{default:n(()=>[g("div",mo,[t[10]||(t[10]=g("h3",null,"Nuove Prenotazioni",-1)),g("ul",null,[(v(!0),D(K,null,Y(o(l),(e,r)=>(v(),D("li",{key:r,class:"prenotazione-item"},[g("div",go,[g("strong",null," Data: "+d(Ae(e.dataPrenotazione)),1),t[8]||(t[8]=g("br",null,null,-1)),g("span",null,d(e.nomeCliente)+" "+d(e.cognomeCliente),1),t[9]||(t[9]=g("br",null,null,-1)),g("span",null,"Servizio: "+d(e.servizioSelezionato),1)])]))),128))])])]),_:1},8,["is-open"]),a(ao,{"is-open":o(F),prenotazioneSelected:p.value,onCloseModal:o(De),onRicaricaOrari:Ce},null,8,["is-open","prenotazioneSelected","onCloseModal"])]),_:1}))}},Io=pe(vo,[["__scopeId","data-v-47f1b6f8"]]);export{Io as default};

import{_ as re,a as se,r as S,o as ke,a5 as Ne,a6 as Oe,n as v,d as B,p as a,s as i,u as n,y as ue,I as ce,v as de,x as c,a7 as xe,a2 as R,t as fe,H as me,L as Ae,N as Te,O as Ee,Q as Fe,z as p,J as ae,R as M,a8 as P,a9 as C,P as f,D,aa as N,G as Le,l as Z,m as He,a1 as Ue,b as qe,ab as k,U as Be,f as Re,e as Ve,q as J,i as q,w as F,h as Q,ac as ie,E as Y,F as K,ad as he,ae as We,K as je,af as le,ag as Je,a0 as Qe,ah as Ye}from"./index-KAKb7uFv.js";const Ke={class:"modal-top"},Ze={key:0,class:"modal-bottom"},Xe={__name:"AlertInformazioniPrenotazione",props:["isOpen","prenotazioneSelected"],emits:["close-modal","ricarica-orari"],setup(X,{emit:V}){const m=X,L=V,y=se(),u=S(null),z=S(!1);ke(()=>{console.log("Modal montato")}),Ne(()=>{console.log("Modal smontato")});const _=()=>{console.log("Modal sta per essere presentato")},$=()=>{console.log("Modal è stato presentato")},O=()=>{console.log("Modal sta per essere chiuso"),I()},b=()=>{console.log("Modal è stato chiuso")};Oe(()=>{m.prenotazioneSelected&&x()});const x=async()=>{try{z.value=!0;const g=Z(y,"Cliente",m.prenotazioneSelected.idDocumentCliente),r=await He(g);r.exists()?(u.value=r.data(),console.log(u.value)):u.value=null,z=!1}catch(g){console.error("Errore nel recupero delle informazioni del cliente:",g),u.value=null,z.value=!1}},G=async()=>{try{z.value=!0;const g=Z(y,"Prenotazioni",m.prenotazioneSelected.id);await Ue(g),console.log("Prenotazione eliminata con successo"),I(),L("ricarica-orari"),z.value=!1}catch(g){console.error("Errore durante l'eliminazione della prenotazione:",g),z.value=!1}},I=()=>{L("close-modal")};return(g,r)=>(v(),B(n(Le),{"is-open":m.isOpen,onClose:r[2]||(r[2]=A=>I()),"backdrop-dismiss":"true",onIonModalWillPresent:_,onIonModalDidPresent:$,onIonModalWillDismiss:O,onIonModalDidDismiss:b},{default:a(()=>[i(n(ue),null,{default:a(()=>[i(n(ce),{color:"primary"},{default:a(()=>[i(n(de),null,{default:a(()=>r[3]||(r[3]=[c("Il mio Modal")])),_:1}),i(n(xe),{slot:"end"},{default:a(()=>[i(n(R),{onClick:r[0]||(r[0]=A=>I())},{default:a(()=>r[4]||(r[4]=[c("close")])),_:1})]),_:1}),i(n(fe),{"is-open":z.value,message:"Please wait..."},null,8,["is-open"])]),_:1})]),_:1}),i(n(me),{class:"ion-padding"},{default:a(()=>[m.prenotazioneSelected?(v(),B(n(Ae),{key:0},{default:a(()=>[i(n(Te),null,{default:a(()=>[i(n(Ee),{class:"ion-text-center"},{default:a(()=>r[5]||(r[5]=[c("Dettagli Prenotazione")])),_:1})]),_:1}),i(n(Fe),{class:"modal-content"},{default:a(()=>[p("div",Ke,[i(n(ae),null,{default:a(()=>[i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[6]||(r[6]=[c("Servizio:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(m.prenotazioneSelected.servizioSelezionato),1)]),_:1})]),_:1}),i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[7]||(r[7]=[c("Durata:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(m.prenotazioneSelected.durataServizioSelezionato)+" minuti",1)]),_:1})]),_:1}),i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[8]||(r[8]=[c("Ora Inizio:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(m.prenotazioneSelected.oraInizio),1)]),_:1})]),_:1}),i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[9]||(r[9]=[c("Ora Fine:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(m.prenotazioneSelected.oraFine),1)]),_:1})]),_:1}),i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[10]||(r[10]=[c("Commento:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(m.prenotazioneSelected.commento),1)]),_:1})]),_:1})]),_:1})]),u.value?(v(),D("div",Ze,[i(n(ae),null,{default:a(()=>[i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[11]||(r[11]=[c("Cliente:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(u.value.nome)+" "+f(u.value.cognome),1)]),_:1})]),_:1}),i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[12]||(r[12]=[c("Cellulare Cliente:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(u.value.cellulare),1)]),_:1})]),_:1}),i(n(M),null,{default:a(()=>[i(n(P),{class:"ion-text-bold"},{default:a(()=>r[13]||(r[13]=[c("Email Cliene:")])),_:1}),i(n(C),null,{default:a(()=>[c(f(u.value.email),1)]),_:1})]),_:1})]),_:1})])):N("",!0),i(n(R),{color:"danger",onClick:r[1]||(r[1]=A=>G())},{default:a(()=>r[14]||(r[14]=[c("Elimina Prenotazione")])),_:1})]),_:1})]),_:1})):N("",!0)]),_:1})]),_:1},8,["is-open"]))}},eo=re(Xe,[["__scopeId","data-v-fd768a41"]]),oo={class:"div-navigazione-mese"},no={class:"mese-titolo"},to=["onClick"],ao={key:0},io=["onClick"],lo={class:"div-informazioni-prenotazione"},ro={key:0},so={key:1,style:{"font-size":"small"}},uo={class:"popover-content"},co={class:"prenotazione-details"},fo={__name:"PrenotazioniGestore",setup(X){const V=Re(),m=se();Ve();const L=qe(),y=S(!1);let u=k(new Date),z=k([]),_=k(new Map),$=k(new Set),O=k(new Set),b=S(!1);const x=S(null);let G=S("");const I=k(new Set);var g=S(!1);const r=V.getters.getIdDocumentNegozioGestore,A=S("");var H=S([]),h=S(0);const{isModalOpen:W,openModal:pe,closeModal:ge}={isModalOpen:S(!1),openModal:()=>W.value=!0,closeModal:()=>W.value=!1};function ve(){g.value=!0}async function ze(){await T()}const Ie=async(t,o,e)=>{if(o){A.value=e;const l=Z(m,"Prenotazioni",e.id);await Je(l,{new:!1}),console.log("Prenotazione aggiornata, campo 'nuovo' impostato a false."),pe(),console.log("prenotato aperto modal")}else{const l=[{text:"Annulla",cssClass:"alert-button-cancel"},{text:"Conferma",cssClass:"alert-button-confirm",handler:async w=>{const E=w[0],Ge=w[1];await Pe(E,Ge,t)}}],s=[{type:"textarea",placeholder:"Inserisci nome cliente"},{type:"textarea",placeholder:"Inserisci scelta utente"}];await(await Qe.create({header:"Inserisci manualmente la prenotazione",buttons:l,inputs:s})).present()}};function j(t){const o=t.getMonth(),e=t.getFullYear(),l=new Date(e,o,1),s=new Date(e,o+1,0),d=[];for(;l<=s;){const w=new Intl.DateTimeFormat("it-IT",{weekday:"long"}).format(l),E={nomeGiornoSettimana:w.charAt(0).toUpperCase()+w.slice(1),numeroGiorno:l.getDate()};d.push(E),l.setDate(l.getDate()+1)}return d}async function U(){try{y.value=!0;const t=L.currentUser.uid,o=J(q(m,"Negozi"),F("proprietarioUid","==",t)),e=await Q(o);if(e.empty)console.error("Nessun documento trovato con uiduser");else{const s=e.docs[0].data().orariLavorativi;_=new Map(Object.entries(s)),console.log("orariMap",_),_.forEach((d,w)=>{_.set(w,d.sort(Se))}),ye(De(u))}y.value=!1}catch(t){y.value=!1,console.error("Errore durante il recupero degli orari:",t)}}function Se(t,o){const[e,l]=t.split(":").map(Number),[s,d]=o.split(":").map(Number);return e!==s?e-s:l-d}function ye(t){console.log("Funzione prendiOrariPergiorno chiamata con il giorno:",t),$.clear(),console.log("orariPerGiorno è stato svuotato.");const o=t.nomeGiornoSettimana;console.log("Nome del giorno della settimana:",o),_.forEach((e,l)=>{l==o&&(console.log("Trovato ".concat(l," nella mappa degli orari con valori:"),e),e.forEach(s=>{console.log("Aggiungendo ora ".concat(s," per il giorno ").concat(o)),$.add(s)}))}),console.log("Orari per il giorno ".concat(o,":"),Array.from($))}function De(t){const o=new Intl.DateTimeFormat("it-IT",{weekday:"long"}).format(t),e={nomeGiornoSettimana:o.charAt(0).toUpperCase()+o.slice(1),numeroGiorno:t.getDate()};return console.log(e),e}async function T(){try{y.value=!0,O.clear(),H.value=[],console.log("Prenotazioni precedenti cancellate.");const t=J(q(m,"Prenotazioni"),F("idDocumentNegozio","==",r),F("dataPrenotazione",">=",u),F("dataPrenotazione","<",new Date(u.getTime()+24*60*60*1e3))),o=J(q(m,"Prenotazioni"),F("idDocumentNegozio","==",r));console.log("Esecuzione della query per recuperare tutte le prenotazioni.");const e=await Q(o);console.log("Trovate ".concat(e.size," prenotazioni totali.")),e.forEach(async s=>{const d=s.data();d.id=s.id,d.new===!0&&(H.value.push(d),console.log("Aggiunta nuova prenotazione: ".concat(JSON.stringify(d))))}),h.value=H.value.length,console.log("Numero di nuove prenotazioni: ".concat(h.value));const l=await Q(t);console.log("Query prenotazioni:",l),l.forEach(async s=>{const d=s.data();d.id=s.id,O.add(d),console.log("Aggiunta prenotazione al set: ".concat(JSON.stringify(d)))}),we(O,$),console.log("Set delle prenotazioni creato."),b.value=!0,y.value=!1,console.log("Operazione completata con successo.")}catch(t){y.value=!1,console.error("Errore durante il recupero delle prenotazioni:",t)}}function we(t,o){console.log("Inizio creazione set oggetti orario."),I.clear();for(const e of o){console.log("Verifica orario: ".concat(e));const l=Array.from(t).find(s=>s.oraInizio==e);if(l)console.log("Trovata prenotazione per orario ".concat(e,":"),l),Me(l);else{console.log("Nessuna prenotazione trovata per orario ".concat(e,". Creazione nuovo oggetto orario."));const s={prenotato:!1,oraInizio:e,sceltaUtente:"",nomeCliente:"",prenotazione:""};ee(s.oraInizio)?console.log("Orario ".concat(e," già presente in setOggettiOrario.")):(I.add(s),console.log("Orario ".concat(e," aggiunto a setOggettiOrario.")))}}console.log("Set oggetti orario creato:",Array.from(I))}function Me(t){const o=t.durataServizioSelezionato;console.log("durata",o);const e=o/15;for(let l=0;l<e;l++){const d={prenotato:!0,oraInizio:$e(t.oraInizio,l*15),sceltaUtente:t.servizioSelezionato,nomeCliente:t.nomeCliente,prenotazione:t,new:t.new};ee(d.oraInizio)||I.add(d)}console.log("Prenotazione orari consecutivi:",Array.from(I))}function ee(t){return Array.from(I).some(o=>o.oraInizio===t)}async function Pe(t,o,e){try{const l={dataPrenotazione:u,idDocumentNegozio:r,oraInizio:e,nomeCliente:t,servizioSelezionato:o,durataServizioSelezionato:15};await Ye(q(m,"Prenotazioni"),l),console.log("Prenotazione inserita:",l),await U(),await T()}catch(l){console.error("Errore durante l'inserimento della prenotazione:",l)}}const oe=t=>t<10?"0".concat(t):t.toString(),Ce=(t,o)=>{const[e,l]=t.split(":").map(Number),s=new Date;return s.setHours(e),s.setMinutes(l+o),"".concat(oe(s.getHours()),":").concat(oe(s.getMinutes()))};async function ne(t){b.value=!1;const o=new Date(u);o.setMonth(o.getMonth()+t),u=o,G=new Intl.DateTimeFormat("it-IT",{month:"long"}).format(u),z=j(u),await U(),await T(),b.value=!0,te(u.getDate()),console.log("Mese spostato a ".concat(G,", giorni del mese:"),z)}Be(async()=>{u.setHours(0,0,0,0),G=new Intl.DateTimeFormat("it-IT",{month:"long"}).format(u),z=j(u),await U(),await T(),te(u.getDate()),console.log("IonViewDidEnter eseguito con successo.")});function te(t){if(x.value){const o=x.value,e=o.children[t];if(e){const l=e.offsetLeft-o.offsetLeft-300;o.scrollLeft=l,console.log("Scroll effettuato a ".concat(t," giorno del mese."))}}}async function _e(t){u.setDate(t.numeroGiorno),z=j(u),await U(),await T(),console.log("Giorno ".concat(u.toLocaleDateString()," cliccato."))}function $e(t,o){const[e,l]=t.split(":").map(Number),s=new Date;return s.setHours(e),s.setMinutes(l+o),"".concat(String(s.getHours()).padStart(2,"0"),":").concat(String(s.getMinutes()).padStart(2,"0"))}function be(t){if(!t||typeof t!="object")return"Data non valida";const o=t.seconds*1e3+Math.floor(t.nanoseconds/1e6),e=new Date(o),l=String(e.getDate()).padStart(2,"0"),s=String(e.getMonth()+1).padStart(2,"0"),d=e.getFullYear(),w=String(e.getHours()).padStart(2,"0"),E=String(e.getMinutes()).padStart(2,"0");return"".concat(l,"/").concat(s,"/").concat(d," ore ").concat(w,":").concat(E)}return(t,o)=>(v(),B(n(je),null,{default:a(()=>[i(n(ue),null,{default:a(()=>[i(n(ce),{color:"primary"},{default:a(()=>[i(n(de),null,{default:a(()=>o[4]||(o[4]=[c("Prenotazioni")])),_:1}),i(n(fe),{"is-open":y.value,message:"Please wait..."},null,8,["is-open"])]),_:1})]),_:1}),i(n(me),{class:"ion-padding"},{default:a(()=>[p("div",oo,[i(n(R),{onClick:o[0]||(o[0]=e=>ne(-1)),class:"button-avanti-indietro"},{default:a(()=>o[5]||(o[5]=[c("Indietro")])),_:1}),p("p",no,f(n(G)),1),i(n(R),{onClick:o[1]||(o[1]=e=>ne(1)),class:"button-avanti-indietro"},{default:a(()=>o[6]||(o[6]=[c("Avanti")])),_:1}),i(n(ie),{color:"warning",onClick:o[2]||(o[2]=e=>ve())},{default:a(()=>[c(" Hai "+f(n(h))+" nuove prenotazioni ",1)]),_:1})]),p("div",{class:"div-contenitore-giorni",ref_key:"contenitoreGiorni",ref:x},[(v(!0),D(K,null,Y(n(z),(e,l)=>(v(),D("div",{class:le(["div-giorno",{"giorno-selezionato":n(u).getDate()===e.numeroGiorno}]),key:l,onClick:s=>_e(e)},f(e.nomeGiornoSettimana)+" "+f(e.numeroGiorno),11,to))),128))],512),n(b)?(v(),D("div",ao,[(v(!0),D(K,null,Y(I,(e,l)=>(v(),D("div",{key:l,class:"div-contenitore-orario",onClick:s=>Ie(e.oraInizio,e.prenotato,e.prenotazione)},[p("div",{class:le({"div-orario":e.prenotato==!1,"div-orario-prenotato":e.prenotato==!0})},f(e.oraInizio)+" / "+f(Ce(e.oraInizio,15)),3),p("div",lo,[e.prenotato?(v(),D("div",ro,f(e.nomeCliente),1)):N("",!0),e.prenotato?(v(),D("div",so,f(e.sceltaUtente),1)):N("",!0)]),e.new?(v(),B(n(ie),{key:0,color:"warning"},{default:a(()=>o[7]||(o[7]=[c("New")])),_:1})):N("",!0)],8,io))),128))])):N("",!0)]),_:1}),i(n(We),{"is-open":n(g),onIonPopoverDidDismiss:o[3]||(o[3]=e=>he(g)?g.value=!1:g=!1)},{default:a(()=>[p("div",uo,[o[10]||(o[10]=p("h3",null,"Nuove Prenotazioni",-1)),p("ul",null,[(v(!0),D(K,null,Y(n(H),(e,l)=>(v(),D("li",{key:l,class:"prenotazione-item"},[p("div",co,[p("strong",null," Data: "+f(be(e.dataPrenotazione)),1),o[8]||(o[8]=p("br",null,null,-1)),p("span",null,f(e.nomeCliente)+" "+f(e.cognomeCliente),1),o[9]||(o[9]=p("br",null,null,-1)),p("span",null,"Servizio: "+f(e.servizioSelezionato),1)])]))),128))])])]),_:1},8,["is-open"]),i(eo,{"is-open":n(W),prenotazioneSelected:A.value,onCloseModal:n(ge),onRicaricaOrari:ze},null,8,["is-open","prenotazioneSelected","onCloseModal"])]),_:1}))}},po=re(fo,[["__scopeId","data-v-624691ed"]]);export{po as default};

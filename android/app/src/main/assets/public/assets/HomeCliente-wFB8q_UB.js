import{_ as J,c as K,g as Q,r,a as W,b as X,o as Y,d as b,u as s,e as Z,f as ee,h as oe,q as ae,i as se,w as le,j as te,k as ne,l as re,m as ie,n as p,p as t,s as l,I as ce,t as ue,v as de,x as I,y as ge,z as m,A as w,B as P,C as S,D as V,E as x,F as B,G as ve,H as R,J as F,K as pe,L as me,M as fe,N as Ie,O as ze,P as y,Q as Ce,R as he}from"./index-CCOiHjrE.js";const be={class:"scritta-nessuno"},we={class:"shop-cards"},ye=["src"],_e={__name:"HomeCliente",setup(ke){const z=K.map(a=>a.nome),H=Q();r(null);const n=r([]),M=Z(),_=ee(),k=W(),E=X(),f=r(!1);let i=r([]);const c=r(""),D=r(""),C=r(!0),u=r(0),d=r([]),h=r(!1),T=()=>{h.value=!0,console.log("click")},N=()=>{h.value=!1};function q(a){const e=a.target.value.toLowerCase();console.log("cercaper citta"),e===""?d.value=[z]:(console.log(z),d.value=z.filter(o=>o.toLowerCase().includes(e)),console.log("suggestion",d.value))}async function O(a){c.value=a,d.value=[],N(),await L(a),i.value=n.value,await U(),i.value=n.value}function j(a){console.log("Input Value:",a.target.value);const e=a.target.value.toLowerCase();e===""?i.value=[...n.value]:(console.log("Filtering items based on search value:",e),i.value=n.value.filter(o=>o.nomeNegozio.toLowerCase().includes(e))),console.log("Updated itemsCopy size:",i.value.length)}const L=async a=>{try{console.log("Inizio caricamento negozi..."),f.value=!0;const e=await oe(ae(se(k,"Negozi"),le("cittaNegozio","==",a)));console.log("Documenti negozi recuperati:",e.size),n.value=e.docs.map(o=>({id:o.id,...o.data()})),f.value=!1}catch(e){f.value=!1,console.error("Errore durante il recupero dei negozi:",e.message)}},U=async()=>{u.value=0;const a=n.value.length;n.value=await Promise.all(n.value.map(async(e,o)=>{const g=te(H,"images/".concat(e.id));let v="";try{v=await ne(g),console.log("URL immagine per il negozio con ID ".concat(e.id,":"),v),u.value=(o+1)/a*100,console.log("Progresso: ".concat(u.value,"%"))}catch($){switch($.code){case"storage/object-not-found":console.error("File non trovato per il negozio con ID ".concat(e.id));break;case"storage/unauthorized":console.error("Utente non autorizzato per il negozio con ID ".concat(e.id));break;default:console.error("Errore sconosciuto durante il recupero dell'URL di download per il negozio con ID ".concat(e.id,":"),$);break}}return{id:e.id,...e,imageUrl:v}})),u.value=100,console.log("Caricamento delle immagini completato.")},A=async()=>{try{const a=re(k,"Cliente",D.value),e=await ie(a);e.exists()?(c.value=e.data().citta,console.log("citta cliente="+c.value)):console.log("Il documento non esiste.")}catch(a){console.error("Errore durante il recupero del documento:",a.message)}},G=a=>{try{console.log("id document on click "+a.id),_.dispatch("setIdDocumentNegozioSelezionato",a.id),_.dispatch("setUrlNegozioSelezionato",a.imageUrl)}catch(e){console.error(e.message)}M.push("/cliente/tabs/tab1/informazioniNegozio")};return Y(async()=>{C.value=!1,D.value=E.currentUser.uid,await A(),await L(c.value),i.value=n.value,await U(),i.value=n.value,C.value=!1}),(a,e)=>(p(),b(s(pe),null,{default:t(()=>[l(s(ge),null,{default:t(()=>[l(s(ce),{color:"primary"},{default:t(()=>[l(s(ue),{"is-open":f.value,message:"Please wait..."},null,8,["is-open"]),l(s(de),null,{default:t(()=>e[4]||(e[4]=[I("Home")])),_:1})]),_:1})]),_:1}),l(s(R),{class:"ion-padding"},{default:t(()=>[e[6]||(e[6]=m("div",{class:"category-buttons"},null,-1)),l(s(w),{class:"ion-searchbar",animated:"true","show-clear-button":"focus",placeholder:"Cerca per nome",debounce:500,onIonInput:e[0]||(e[0]=o=>j(o))}),l(s(w),{class:"ion-searchbar",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),animated:"true","show-clear-button":"focus",placeholder:"Cerca per città",debounce:500,onClick:e[2]||(e[2]=o=>T())},null,8,["modelValue"]),P(m("p",be,"nessun negozio trovato in base alla città o al nome",512),[[S,s(i).size===0]]),m("div",we,[(p(!0),V(B,null,x(s(i),(o,g)=>(p(),b(s(me),{class:"shop-card",key:g,onClick:v=>G(o)},{default:t(()=>[m("img",{class:"card-image",alt:"Image of shop",src:o.imageUrl},null,8,ye),P(l(s(fe),{value:u.value/100,color:"primary"},null,8,["value"]),[[S,C.value]]),l(s(Ie),{class:"card-header"},{default:t(()=>[l(s(ze),null,{default:t(()=>[I(y(o.nomeNegozio),1)]),_:2},1024)]),_:2},1024),e[5]||(e[5]=m("div",{class:"line"},null,-1)),l(s(Ce),{class:"card-content"},{default:t(()=>[I(y(o.indirizzoNegozio+","+o.cittaNegozio),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),l(s(ve),{"is-open":h.value,onDidDismiss:N,"initial-breakpoint":.75,breakpoints:[0,.25,.5,.75]},{default:t(()=>[l(s(R),{class:"ion-padding"},{default:t(()=>[l(s(w),{class:"ion-searchbar",animated:"true","show-clear-button":"focus",placeholder:"Inserisci la citta che vuoi cercare",debounce:500,onIonInput:e[3]||(e[3]=o=>q(o))}),l(s(F),null,{default:t(()=>[l(s(F),{class:"suggestions-list"},{default:t(()=>[(p(!0),V(B,null,x(d.value,(o,g)=>(p(),b(s(he),{key:g,onClick:v=>O(o),lines:"full",detail:""},{default:t(()=>[I(y(o),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}},Ne=J(_e,[["__scopeId","data-v-05b2d4df"]]);export{Ne as default};
